"use strict";(self.webpackChunknightwood_frontend=self.webpackChunknightwood_frontend||[]).push([[720],{3720:(G,P,i)=>{i.r(P),i.d(P,{StartModule:()=>m});var l=i(6895),p=i(7715),r=i(4006),g=i(1135),w=i(9751),v=i(8505),x=i(262),M=i(3900),s=i(2402),t=i(8274),_=i(8747),Z=i(3022),O=i(4549),A=i(5770),b=i(208),k=i(7615),C=i(4463);function I(o,e){if(1&o&&(t.TgZ(0,"div",2)(1,"app-loading-indicator",3),t._uU(2),t.ALo(3,"async"),t.qZA()()),2&o){const n=t.oxw();t.xp6(2),t.hij(" ",t.lcZ(3,1,n.confirm$)," ")}}const T=function(){return{value:"nickname"}};function S(o,e){1&o&&(t.TgZ(0,"div",21),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.hij(" ",t.xi3(2,1,"errors.incorrectFieldsValue",t.DdM(4,T))," "))}const $=function(){return{value:"password"}};function J(o,e){1&o&&(t.TgZ(0,"div",22),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.hij(" ",t.xi3(2,1,"errors.incorrectFieldsValue",t.DdM(4,$))," "))}function U(o,e){1&o&&(t.TgZ(0,"button",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"start.login")," "))}function N(o,e){if(1&o&&(t.TgZ(0,"div",24)(1,"app-loading-indicator",25),t._uU(2),t.ALo(3,"async"),t.qZA()()),2&o){const n=t.oxw(2);t.xp6(2),t.hij(" ",t.lcZ(3,1,n.login$)," ")}}function Y(o,e){if(1&o){const n=t.EpF();t.TgZ(0,"div",2)(1,"div",4)(2,"div",5),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"div",6),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"div",7),t._UZ(9,"img",8),t.qZA(),t.TgZ(10,"div",9)(11,"form",10),t.NdJ("ngSubmit",function(){t.CHM(n);const c=t.oxw();return t.KtG(c.login())})("keydown.enter",function(){t.CHM(n);const c=t.oxw();return t.KtG(c.login())}),t.TgZ(12,"div",11),t._uU(13),t.ALo(14,"translate"),t.qZA(),t._UZ(15,"input",12),t.YNc(16,S,3,5,"div",13),t.TgZ(17,"div",14),t._uU(18),t.ALo(19,"translate"),t.qZA(),t._UZ(20,"input",15),t.YNc(21,J,3,5,"div",16),t.YNc(22,U,3,3,"button",17),t.ALo(23,"async"),t.YNc(24,N,4,3,"div",18),t.ALo(25,"async"),t.qZA()(),t.TgZ(26,"button",19),t.ALo(27,"async"),t._uU(28),t.ALo(29,"translate"),t.qZA(),t.TgZ(30,"div",20),t.NdJ("click",function(){t.CHM(n);const c=t.oxw();return t.KtG(c.displayForgotPasswordModal$.next(!0))}),t._uU(31),t.ALo(32,"translate"),t.qZA()()()}if(2&o){const n=t.oxw();t.xp6(3),t.Oqu(t.lcZ(4,12,"common.appName")),t.xp6(3),t.Oqu(t.lcZ(7,14,"common.appHint")),t.xp6(5),t.Q6J("formGroup",n.form),t.xp6(2),t.Oqu(t.lcZ(14,16,"start.nickname")),t.xp6(3),t.Q6J("ngIf",n.form.controls.nickname.dirty&&!n.form.controls.nickname.valid),t.xp6(2),t.Oqu(t.lcZ(19,18,"start.password")),t.xp6(3),t.Q6J("ngIf",n.form.controls.password.dirty&&!n.form.controls.password.valid),t.xp6(1),t.Q6J("ngIf",!t.lcZ(23,20,n.loginLoading$)),t.xp6(2),t.Q6J("ngIf",t.lcZ(25,22,n.loginLoading$)),t.xp6(2),t.Q6J("disabled",t.lcZ(27,24,n.loginLoading$)),t.xp6(2),t.hij(" ",t.lcZ(29,26,"start.register")," "),t.xp6(3),t.hij(" ",t.lcZ(32,28,"start.forgotPassword")," ")}}function q(o,e){if(1&o){const n=t.EpF();t.TgZ(0,"app-forgot-password",26),t.NdJ("close",function(){t.CHM(n);const c=t.oxw();return t.KtG(c.displayForgotPasswordModal$.next(!1))}),t.qZA()}}class u{constructor(e,n,a,c,L,K){this.router=e,this.route=n,this.authController=a,this.toastService=c,this.engineService=L,this.repositoryService=K,this.form=new r.cw({nickname:new r.NI(null,[r.kI.required,r.kI.minLength(s.yv),r.kI.maxLength(s.C_)]),password:new r.NI(null,[r.kI.required,r.kI.minLength(s.Z9),r.kI.maxLength(s.e2)])}),this.fields=[{form:this.form,key:"login",label:"start.nickname",type:"text",autocomplete:"username"},{form:this.form,key:"password",label:"start.password",type:"password",autocomplete:"current-password"}],this.loginLoading$=new g.X(!1),this.login$=new w.y,this.confirmLoading$=new g.X(!1),this.confirm$=new w.y,this.displayForgotPasswordModal$=new g.X(!1)}ngOnInit(){this.route.queryParams.subscribe(e=>{const n=e.token;n&&this.confirm(n)})}confirm(e){const n={activationCode:e};this.confirmLoading$?.next(!0),this.confirm$=this.authController.confirm(n).pipe((0,v.b)(()=>{this.confirmLoading$?.next(!1),this.toastService.showSuccess("start.loginSuccess","start.confirmSuccess")}),(0,x.K)(a=>{throw this.confirmLoading$?.next(!1),a}))}login(){if(!this.form.value.nickname||!this.form.value.password)return void this.toastService.showError("errors.formInvalid","errors.formInvalidHint");const e={nickname:this.form.value.nickname,password:this.form.value.password};this.loginLoading$?.next(!0),this.login$=this.authController.login(e).pipe((0,M.w)(n=>(this.repositoryService.clearUserData(),this.repositoryService.setAccessToken(n.accessToken),this.repositoryService.setRefreshToken(n.refreshToken),this.repositoryService.setUserData(n),this.engineService.setInitialState(n),this.engineService.getExpeditionReports())),(0,v.b)(()=>{this.loginLoading$?.next(!1),this.toastService.showSuccess("start.loginSuccess","start.loginSuccessHint"),this.router.navigate(["../game/home"])}),(0,x.K)(n=>{throw this.loginLoading$?.next(!1),n}))}}u.\u0275fac=function(e){return new(e||u)(t.Y36(p.F0),t.Y36(p.gz),t.Y36(_.QD),t.Y36(Z.k),t.Y36(O.S),t.Y36(A.b))},u.\u0275cmp=t.Xpm({type:u,selectors:[["app-login"]],decls:6,vars:9,consts:[["class","wrapper-main",4,"ngIf"],[3,"close",4,"ngIf"],[1,"wrapper-main"],["data-testid","app-confirm-spinner"],[1,"wrapper-content"],["data-testid","app-title",1,"title","title-main"],["data-testid","app-hint",1,"title","text-hint"],[1,"wrapper-img"],["data-testid","app-brand-image","src","assets/img/app/logo.png","alt","logo","draggable","false"],[1,"wrapper-form"],["data-testid","app-login-form",3,"formGroup","ngSubmit","keydown.enter"],["data-testid","app-login-label",1,"label"],["type","text","formControlName","nickname","autocomplete","nickname","data-testid","app-login-input",1,"input"],["class","error","data-testid","app-login-error",4,"ngIf"],["data-testid","app-password-label",1,"label",2,"margin-top","8px"],["type","password","formControlName","password","autocomplete","current-password","data-testid","app-password-input",1,"input"],["class","error","data-testid","app-password-error",4,"ngIf"],["type","submit","class","btn-base","data-testid","app-login-button",4,"ngIf"],["class","spinner",4,"ngIf"],["routerLink","../register","data-testid","app-register-button",1,"btn-base",3,"disabled"],[1,"btn-forgot",3,"click"],["data-testid","app-login-error",1,"error"],["data-testid","app-password-error",1,"error"],["type","submit","data-testid","app-login-button",1,"btn-base"],[1,"spinner"],["data-testid","app-form-submit-spinner"],[3,"close"]],template:function(e,n){1&e&&(t.YNc(0,I,4,3,"div",0),t.ALo(1,"async"),t.YNc(2,Y,33,30,"div",0),t.ALo(3,"async"),t.YNc(4,q,1,0,"app-forgot-password",1),t.ALo(5,"async")),2&e&&(t.Q6J("ngIf",t.lcZ(1,3,n.confirmLoading$)),t.xp6(2),t.Q6J("ngIf",!t.lcZ(3,5,n.confirmLoading$)),t.xp6(2),t.Q6J("ngIf",t.lcZ(5,7,n.displayForgotPasswordModal$)))},dependencies:[l.O5,p.rH,r._Y,r.Fj,r.JJ,r.JL,r.sg,r.u,b.Q,k.o,l.Ov,C.X$],styles:[".color-Common[_ngcontent-%COMP%]{color:#bbc3c8}.color-Scarce[_ngcontent-%COMP%]{color:#cdc90b}.color-Rare[_ngcontent-%COMP%]{color:#c967eb}.color-Mythical[_ngcontent-%COMP%]{color:#00e1e1}.wrapper-main[_ngcontent-%COMP%]{height:100%;padding:0;align-content:center}.wrapper-content[_ngcontent-%COMP%]{max-width:600px;min-height:none;height:auto;margin:auto;padding:2rem 0rem}.title[_ngcontent-%COMP%]{color:#c5a45f}.wrapper-img[_ngcontent-%COMP%]{width:90%;max-width:250px;margin:20px auto}.wrapper-img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;margin:0;animation:_ngcontent-%COMP%_color-rotate 3s;animation-iteration-count:infinite;animation-direction:alternate}@keyframes _ngcontent-%COMP%_color-rotate{0%{filter:hue-rotate(0deg)}to{filter:hue-rotate(360deg)}}.wrapper-form[_ngcontent-%COMP%]{width:95%;max-width:240px;margin:0 auto 40px}.wrapper-form[_ngcontent-%COMP%]   .btn-base[_ngcontent-%COMP%]{max-width:100%}.title-main[_ngcontent-%COMP%]{margin-bottom:20px}.text-hint[_ngcontent-%COMP%]{font-size:20px}.btn-base[_ngcontent-%COMP%], .spinner[_ngcontent-%COMP%]{margin:20px auto}.btn-forgot[_ngcontent-%COMP%]{max-width:240px;margin:auto;color:#ffeeca;font-weight:500;font-size:13px;letter-spacing:.5px;cursor:pointer}.btn-forgot[_ngcontent-%COMP%]:hover{text-decoration:underline}@media screen and (max-width: 990px){.wrapper-content[_ngcontent-%COMP%]{height:100%}}"],changeDetection:0});const y=function(){return{value:"password"}};function Q(o,e){1&o&&(t.TgZ(0,"div",8),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.hij(" ",t.xi3(2,1,"errors.incorrectFieldsValue",t.DdM(4,y))," "))}function F(o,e){1&o&&(t.TgZ(0,"div",8),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.hij(" ",t.xi3(2,1,"errors.incorrectFieldsValue",t.DdM(4,y))," "))}class h{constructor(e,n,a,c){this.router=e,this.route=n,this.authController=a,this.toastService=c,this.actionCode="",this.newPassword=new r.NI(null,[r.kI.required,r.kI.minLength(s.Z9),r.kI.maxLength(s.e2)]),this.newPasswordConfirm=new r.NI(null,[r.kI.required]),this.resetPasswordLoading$=new g.X(!1),this.resetPassword$=new w.y}ngOnInit(){this.route.queryParams.subscribe(e=>{this.actionCode=e.token})}resetPassword(){if(!this.newPassword.value||!this.newPassword.valid||!this.newPasswordConfirm.valid)return;if(this.newPassword.value!==this.newPasswordConfirm.value)return void this.toastService.showError("errors.error","start.passwordsMismatch");const e={actionToken:this.actionCode,newPassword:this.newPassword.value};this.resetPasswordLoading$.next(!0),this.resetPassword$=this.authController.resetPassword(e).pipe((0,v.b)(()=>{this.toastService.showSuccess("common.success","start.passwordResetSuccess"),this.router.navigate(["login"])}),(0,x.K)(n=>{throw this.resetPasswordLoading$.next(!1),n}))}}h.\u0275fac=function(e){return new(e||h)(t.Y36(p.F0),t.Y36(p.gz),t.Y36(_.QD),t.Y36(Z.k))},h.\u0275cmp=t.Xpm({type:h,selectors:[["app-password-reset"]],decls:21,vars:22,consts:[[1,"wrapper-main"],[1,"wrapper-content"],[1,"title"],[1,"wrapper-form"],[1,"label"],["type","password",1,"input",3,"formControl"],["class","error",4,"ngIf"],[1,"btn-base",3,"disabled","click"],[1,"error"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"div",3)(6,"div",4),t._uU(7),t.ALo(8,"translate"),t.qZA(),t._UZ(9,"input",5),t.YNc(10,Q,3,5,"div",6),t.TgZ(11,"div",4),t._uU(12),t.ALo(13,"translate"),t.qZA(),t._UZ(14,"input",5),t.YNc(15,F,3,5,"div",6),t.TgZ(16,"button",7),t.NdJ("click",function(){return n.resetPassword()}),t.ALo(17,"async"),t._uU(18),t.ALo(19,"translate"),t.ALo(20,"async"),t.qZA()()()()),2&e&&(t.xp6(3),t.Oqu(t.lcZ(4,10,"start.resetPassword")),t.xp6(4),t.Oqu(t.lcZ(8,12,"start.newPassword")),t.xp6(2),t.Q6J("formControl",n.newPassword),t.xp6(1),t.Q6J("ngIf",n.newPassword.dirty&&!n.newPassword.valid),t.xp6(2),t.Oqu(t.lcZ(13,14,"start.newPasswordConfirm")),t.xp6(2),t.Q6J("formControl",n.newPasswordConfirm),t.xp6(1),t.Q6J("ngIf",n.newPasswordConfirm.dirty&&!n.newPasswordConfirm.valid),t.xp6(1),t.Q6J("disabled",t.lcZ(17,16,n.resetPasswordLoading$)),t.xp6(2),t.AsE(" ",t.lcZ(19,18,"common.confirm")," ",t.lcZ(20,20,n.resetPassword$)," "))},dependencies:[l.O5,r.Fj,r.JJ,r.oH,l.Ov,C.X$],styles:[".wrapper-main[_ngcontent-%COMP%]{height:100%;padding:0;align-content:center}.wrapper-content[_ngcontent-%COMP%]{max-width:600px;min-height:none;height:auto;margin:auto;padding:2rem 0rem}.wrapper-form[_ngcontent-%COMP%]{max-width:240px;margin:20px auto}.label[_ngcontent-%COMP%]{margin-top:10px}.btn-base[_ngcontent-%COMP%]{margin-top:30px;max-width:100%}"],changeDetection:0});var R=i(2257),j=i(253);function H(o,e){1&o&&t._UZ(0,"app-input-base",10),2&o&&t.Q6J("options",e.$implicit)}function D(o,e){if(1&o&&(t.TgZ(0,"button",11),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o){const n=t.oxw();t.Q6J("disabled",!n.form.valid),t.xp6(1),t.hij(" ",t.lcZ(2,2,"start.register")," ")}}function X(o,e){if(1&o&&(t.TgZ(0,"div",12)(1,"app-loading-indicator"),t._uU(2),t.ALo(3,"async"),t.qZA()()),2&o){const n=t.oxw();t.xp6(2),t.hij(" ",t.lcZ(3,1,n.register$)," ")}}class f{constructor(e,n,a,c,L){this.router=e,this.translateService=n,this.authController=a,this.toastService=c,this.validatorService=L,this.form=new r.cw({email:new r.NI(null,[r.kI.required,r.kI.email,r.kI.maxLength(s.bV)]),nickname:new r.NI(null,[r.kI.required,r.kI.minLength(s.yv),r.kI.maxLength(s.C_)]),password:new r.NI(null,[r.kI.required,r.kI.minLength(s.Z9),r.kI.maxLength(s.e2)]),passwordConfirm:new r.NI(null,[r.kI.required,r.kI.minLength(s.Z9),r.kI.maxLength(s.e2)])}),this.fields=[{form:this.form,key:"email",label:"start.email",type:"email",autocomplete:"email"},{form:this.form,key:"nickname",label:"start.nickname",type:"text",autocomplete:"off"},{form:this.form,key:"password",label:"start.password",type:"password",autocomplete:"new-password"},{form:this.form,key:"passwordConfirm",label:"start.passwordConfirm",type:"password",autocomplete:"new-password"}],this.submitLoading$=new g.X(!1),this.register$=new w.y}ngOnInit(){const e=this.fields.filter(a=>"nickname"===a.key)[0],n=this.fields.filter(a=>"password"===a.key)[0];e.hint=this.translateService.instant("start.nicknameHint",{min:s.yv,max:s.C_}),n.hint=this.translateService.instant("start.passwordHint",{min:s.Z9,max:s.e2})}validatePasswords(){return this.form.value.password===this.form.value.passwordConfirm}register(){if(!(this.form.valid&&this.form.value.email&&this.form.value.nickname&&this.form.value.password))return void this.toastService.showError("errors.formInvalid","errors.formInvalidHint");if(!this.validatePasswords())return void this.toastService.showError("errors.error","start.passwordsMismatch");if(this.form.value.nickname&&!this.validatorService.checkBannedWords(this.form.value.nickname))return;const e={email:this.form.value.email,nickname:this.form.value.nickname,password:this.form.value.password};this.submitLoading$.next(!0),this.register$=this.authController.register(e).pipe((0,v.b)(()=>{this.submitLoading$.next(!1),this.toastService.showSuccess("start.registerSuccess","start.confirmEmail"),this.router.navigate(["../start/login"])}),(0,x.K)(n=>{throw this.submitLoading$.next(!1),n}))}}f.\u0275fac=function(e){return new(e||f)(t.Y36(p.F0),t.Y36(C.sK),t.Y36(_.QD),t.Y36(Z.k),t.Y36(R.o))},f.\u0275cmp=t.Xpm({type:f,selectors:[["app-register"]],decls:22,vars:20,consts:[[1,"wrapper-main"],[1,"wrapper-content"],[1,"title","title-main"],[1,"title","title-small"],[1,"wrapper-form"],[3,"formGroup","ngSubmit"],[3,"options",4,"ngFor","ngForOf"],["class","btn-base",3,"disabled",4,"ngIf"],["class","spinner","style","margin-top: 20px;",4,"ngIf"],["routerLink","../login",1,"btn-base"],[3,"options"],[1,"btn-base",3,"disabled"],[1,"spinner",2,"margin-top","20px"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"div",3)(6,"p"),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.TgZ(9,"p"),t._uU(10),t.ALo(11,"translate"),t.qZA()(),t.TgZ(12,"div",4)(13,"form",5),t.NdJ("ngSubmit",function(){return n.register()}),t.YNc(14,H,1,1,"app-input-base",6),t.YNc(15,D,3,4,"button",7),t.ALo(16,"async"),t.YNc(17,X,4,3,"div",8),t.ALo(18,"async"),t.qZA()(),t.TgZ(19,"button",9),t._uU(20),t.ALo(21,"translate"),t.qZA()()()),2&e&&(t.xp6(3),t.Oqu(t.lcZ(4,8,"common.appName")),t.xp6(4),t.Oqu(t.lcZ(8,10,"start.registerHint")),t.xp6(3),t.Oqu(t.lcZ(11,12,"start.registerLore")),t.xp6(3),t.Q6J("formGroup",n.form),t.xp6(1),t.Q6J("ngForOf",n.fields),t.xp6(1),t.Q6J("ngIf",!t.lcZ(16,14,n.submitLoading$)),t.xp6(2),t.Q6J("ngIf",t.lcZ(18,16,n.submitLoading$)),t.xp6(3),t.hij(" ",t.lcZ(21,18,"common.back")," "))},dependencies:[l.sg,l.O5,p.rH,r._Y,r.JL,r.sg,b.Q,j.r,l.Ov,C.X$],styles:[".color-Common[_ngcontent-%COMP%]{color:#bbc3c8}.color-Scarce[_ngcontent-%COMP%]{color:#cdc90b}.color-Rare[_ngcontent-%COMP%]{color:#c967eb}.color-Mythical[_ngcontent-%COMP%]{color:#00e1e1}.wrapper-main[_ngcontent-%COMP%]{height:100%;padding:0;align-content:center}.wrapper-content[_ngcontent-%COMP%]{max-width:600px;min-height:none;height:auto;margin:auto;padding:2rem 0rem}.title[_ngcontent-%COMP%]{color:#c5a45f}.wrapper-img[_ngcontent-%COMP%]{width:90%;max-width:250px;margin:20px auto}.wrapper-img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;margin:0}.wrapper-form[_ngcontent-%COMP%]{margin-top:20px;margin-bottom:40px}.title-main[_ngcontent-%COMP%]{margin-bottom:20px}.title-small[_ngcontent-%COMP%]{font-size:20px;line-height:1;padding:10px 0}.text-hint[_ngcontent-%COMP%]{font-size:20px}.btn-base[_ngcontent-%COMP%]{margin:20px auto}@media screen and (max-width: 990px){.wrapper-content[_ngcontent-%COMP%]{height:100%}}"],changeDetection:0});const E=[{path:"login",component:u},{path:"register",component:f},{path:"reset-password",component:h},{path:"**",redirectTo:"login",pathMatch:"full"}];class d{}d.\u0275fac=function(e){return new(e||d)},d.\u0275mod=t.oAB({type:d}),d.\u0275inj=t.cJS({imports:[p.Bz.forChild(E),p.Bz]});var z=i(294);class m{}m.\u0275fac=function(e){return new(e||m)},m.\u0275mod=t.oAB({type:m}),m.\u0275inj=t.cJS({imports:[l.ez,d,z.I.forChild()]})}}]);